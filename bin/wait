#!/bin/bash

echo "GITLAB_URL: ${GITLAB_URL}"
echo "Waiting for GitLab to become available..."

wget --retry-connrefused --tries 5 -O - $GITLAB_URL &>/dev/null
curl --silent --head --fail -o /dev/null --retry 10 \
     --retry-delay 1 --max-time 2 --retry-max-time 20 $GITLAB_URL

if [ "$?" -eq 0 ]; then
  echo 'GitLab is available'
else
  echo -e "\033[31;1mGitLab service is not available!\033[0m"
  exit 1
fi
